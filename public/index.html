<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rail-Ready — Ipari & vasúti logisztikai portfólió</title>
  <meta name="description" content="Rail-Ready — vasútra optimalizált ipari és logisztikai ingatlanok Magyarországon. Portfólió, hírek és kapcsolatfelvétel." />
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/favicon.ico" />

  <!-- Leaflet CSS (térképhez) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+e2fBrdGkR5v6cQ0oQxR3uX1gqI5fQS2a0r2J6XdM=" crossorigin=""/>

  <style>
    :root {
      --gold: #DAA520;
      --ink: #111;
      --muted: #6b7280;
      --max-width: 1100px;
      --radius: 12px;
    }
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; color:var(--ink); background:#fff; }
    a { color: inherit; text-decoration: none; }

    /* Layout */
    .container { max-width: var(--max-width); margin:0 auto; padding:0 18px; }
    .nav { display:flex; align-items:center; gap:16px; padding:14px 0; border-bottom:1px solid #eee; }
    .nav img.logo { height:36px; }
    .nav-right { margin-left:auto; display:flex; gap:14px; align-items:center; font-weight:600; }
    .btn { display:inline-block; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn-gold { background:var(--gold); color:#111; }
    .btn-ghost { border:1px solid rgba(0,0,0,.12); background:transparent; }

    /* HERO */
    #hero { position:relative; min-height:60vh; display:flex; align-items:center; justify-content:center; text-align:center; color:white; overflow:hidden; }
    #hero .bg { position:absolute; inset:0; background-image:url('hero-rail.jpg'); background-size:cover; background-position:center; transform:scale(1); filter:brightness(.48); }
    #hero .content { position:relative; z-index:2; padding:40px 20px; max-width:900px; }
    .title { font-size: clamp(28px, 6vw, 56px); margin:0 0 8px; font-weight:700; letter-spacing:1px; color:var(--gold); text-shadow:0 4px 18px rgba(0,0,0,.5); }
    .subtitle { margin:0 0 18px; font-size:clamp(16px,3vw,20px); color:#fff; text-shadow:0 2px 8px rgba(0,0,0,.4); }

    section { padding:48px 0; }
    h2 { font-size:1.5rem; margin:0 0 14px; color:#222; }

    /* Grid */
    .grid { display:grid; gap:18px; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); }

    .card { border-radius: var(--radius); overflow:hidden; border:1px solid #eee; background:#fff; box-shadow: 0 6px 18px rgba(0,0,0,.04); }
    .card img { width:100%; height:180px; object-fit:cover; display:block; }
    .card .body { padding:14px; }
    .badge { display:inline-block; background:#f3f4f6; padding:6px 10px; border-radius:999px; font-size:12px; margin-right:8px; margin-top:6px; color:#444; }

    /* Map */
    #map { height:420px; border-radius:12px; border:1px solid #eee; }

    /* News */
    .news-card { background:#111; color:#fff; border-radius:12px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.16); }
    .news-card img { height:180px; width:100%; object-fit:cover; display:block; }

    /* Contact */
    .contact-card { max-width:760px; margin:0 auto; padding:20px; border-radius:12px; border:1px solid #eee; }
    label { display:block; margin-bottom:6px; font-size:0.9rem; color:#333; }
    input, textarea { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #ddd; margin-bottom:12px; }
    textarea { min-height:120px; resize:vertical; }

    footer { background:#fafafa; border-top:1px solid #eee; padding:18px 0; color:#666; font-size:.95rem; }

    @media (max-width:640px) {
      .nav { padding:10px 0; }
      .title { font-size:28px; }
      .subtitle { font-size:15px; }
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <div class="container nav" role="navigation" aria-label="Felső menü">
    <img src="logoip.jpg" alt="Rail-Ready logó" class="logo" />
    <div class="nav-right">
      <a href="#portfolio">Portfólió</a>
      <a href="#map">Térkép</a>
      <a href="#news">Hírek</a>
      <a href="#contact" class="btn btn-gold">Kapcsolat</a>
    </div>
  </div>

  <!-- HERO -->
  <section id="hero" aria-label="Nyitó">
    <div class="bg" role="img" aria-label="vasúti logisztika"></div>
    <div class="content container">
      <h1 class="title">Ipari területek Magyarországon — vasútra optimalizálva</h1>
      <p class="subtitle">Rail-Ready portfólió — közvetlen vasúti bekötéssel, autópálya-kapcsolattal és kiemelt energetikai kapacitással.</p>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
        <a href="#portfolio" class="btn btn-gold">Portfólió megtekintése</a>
        <a href="#map" class="btn btn-ghost">Térkép</a>
      </div>
    </div>
  </section>

  <!-- INTRO -->
  <section id="intro" class="container" aria-label="Bemutatkozás">
    <h2>Magyarország: kelet–nyugati logisztikai kapu</h2>
    <p style="max-width:900px;margin:0 0 18px;">Portfóliónk olyan ipari és logisztikai területeket mutat be, amelyek vasúti bekötéssel és jelentős energetikai kapacitással rendelkeznek — ideálisak nagy volumenű, intermodális szállítmányok kezelésére.</p>
  </section>

  <!-- PORTFOLIO -->
  <section id="portfolio" class="container" aria-label="Portfólió">
    <h2>Rail-Ready portfólió</h2>
    <p style="color:var(--muted);margin:0 0 18px;">Az alábbi listát dinamikusan töltjük be a <code>portfolio.hu.json</code> állományból.</p>
    <div id="portfolio-grid" class="grid" aria-live="polite">
      <!-- Kártyák ide kerülnek -->
    </div>
  </section>

  <!-- MAP -->
  <section id="map-section" class="container" aria-label="Térkép">
    <h2>Térkép</h2>
    <p style="color:var(--muted); margin:0 0 12px;">A térképen azok az ingatlanok jelennek meg, amelyeknél a `lat` és `lng` mezők meg vannak adva a `portfolio.hu.json` fájlban. (Ha nincs, lásd a README javaslatát a geokódolásra.)</p>
    <div id="map" aria-hidden="false"></div>
    <div id="map-note" style="margin-top:8px;color:var(--muted);font-size:.95rem;"></div>
  </section>

  <!-- NEWS -->
  <section id="news" class="container" aria-label="Hírek">
    <h2>Hírek és elemzések</h2>
    <div id="news-grid" class="grid" style="margin-top:12px;">
      <!-- Hírek -->
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="container" aria-label="Kapcsolat" style="padding-bottom:60px;">
    <h2>Kapcsolat</h2>
    <div class="contact-card" role="form" aria-labelledby="contact-title">
      <p style="margin:0 0 12px;color:var(--muted);">Használd az alábbi űrlapot — a küldés az e-mail címedre előkészített levél formájában nyílik meg (nincs szükség szerverre).</p>
      <form id="contact-form">
        <label for="c-name">Név *</label>
        <input id="c-name" name="name" required placeholder="Teljes név" />
        <label for="c-company">Cég</label>
        <input id="c-company" name="company" placeholder="Cég (opcionális)" />
        <label for="c-email">Email *</label>
        <input id="c-email" name="email" type="email" required placeholder="email@pelda.hu" />
        <label for="c-message">Üzenet *</label>
        <textarea id="c-message" name="message" required placeholder="Írd le röviden, melyik ingatlan érdekel..."></textarea>
        <div style="display:flex;gap:10px;align-items:center;">
          <button type="submit" class="btn btn-gold">Üzenet előkészítése</button>
          <small style="color:var(--muted)">A küldés a levelezőben történik.</small>
        </div>
      </form>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="container" role="contentinfo" style="margin-top:30px;">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;padding:18px 0;">
      <div>© iparingatlan.com — Rail-Ready</div>
      <div><a href="#hero">Vissza az elejére ↑</a></div>
    </div>
  </footer>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1j8mTt2b2b2o0hF1vQ8a+GJ8r/4k4Xc1a5rU5o+I=" crossorigin=""></script>

  <script>
  // --- Segéd: biztonságos fetch wrapper (egyszerű hibaüzenetek) ---
  async function safeFetchJSON(url) {
    try {
      const res = await fetch(url, {cache:'no-store'});
      if (!res.ok) throw new Error('HTTP ' + res.status);
      return await res.json();
    } catch (e) {
      console.error('Hiba a betöltéskor:', url, e);
      return null;
    }
  }

  // --- PORTFOLIO betöltés és render ---
  async function loadPortfolio() {
    const items = await safeFetchJSON('portfolio.hu.json');
    const grid = document.getElementById('portfolio-grid');
    if (!items || !Array.isArray(items)) {
      grid.innerHTML = '<p style="color:var(--muted)">A portfólió jelenleg nem elérhető.</p>';
      return;
    }

    grid.innerHTML = '';
    const markers = []; // térképhez

    items.forEach(p => {
      const title = p.title || 'Ismeretlen ingatlan';
      const city = p.city ? `<strong>${p.city}</strong>` : '';
      const size = p.size_ha ? `<div><strong>Terület:</strong> ${p.size_ha} ha</div>` : '';
      const rail = (p.rail_access === true) ? `<div style="color:var(--gold)"><strong>Vasút:</strong> ${p.rail_notes || 'iparvágány/vasút elérhető'}</div>` :
                   (p.rail_access === false ? `<div><strong>Vasút:</strong> nincs közvetlen</div>` : '');
      const energy = p.energy_mw ? `<div><strong>Energia:</strong> ${p.energy_mw} MW</div>` : '';
      const gallery = Array.isArray(p.gallery) && p.gallery.length ? p.gallery : (p.image ? [p.image] : ['gallery-rail-1.jpg']);
      const mainImg = gallery[0] || 'gallery-rail-1.jpg';

      // Card
      const article = document.createElement('article');
      article.className = 'card';
      article.innerHTML = `
        <img src="${mainImg}" alt="${escapeHtml(title)}" loading="lazy" decoding="async">
        <div class="body">
          <h3 style="margin:4px 0 8px;font-size:18px">${escapeHtml(title)}</h3>
          ${city}
          ${rail}
          ${size}
          ${energy}
          <div style="margin-top:10px">
            ${(Array.isArray(p.features) ? p.features.map(f => `<span class="badge">${escapeHtml(f)}</span>`).join('') : '')}
          </div>
          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <a href="${p.link || '#'}" class="btn btn-ghost" style="padding:8px 12px;font-size:14px">Részletek</a>
            <button class="btn btn-gold" style="padding:8px 12px;font-size:14px" onclick='openInterest("${encodeURIComponent(title)}","${encodeURIComponent(p.id||'') }")'>Érdekel</button>
          </div>
        </div>
      `;
      grid.appendChild(article);

      // Térkép marker (ha van lat/lng)
      if (p.lat && p.lng) {
        markers.push({
          lat: parseFloat(p.lat),
          lng: parseFloat(p.lng),
          title,
          city,
          snippet: (rail || size || energy || '')
        });
      }
    });

    // Ha van térkép markers, inicializáljuk
    initMap(markers);
  }

  // --- NEWS betöltés ---
  async function loadNews() {
    const items = await safeFetchJSON('hirek.json');
    const grid = document.getElementById('news-grid');
    if (!items || !Array.isArray(items)) {
      grid.innerHTML = '<p style="color:var(--muted)">A hírek jelenleg nem elérhetők.</p>';
      return;
    }
    grid.innerHTML = '';
    items.forEach(n => {
      const title = n.title || '';
      const img = n.image || 'hero-rail.jpg';
      const excerpt = n.excerpt || (Array.isArray(n.body) ? n.body[0].slice(0,160)+'...' : '');
      const card = document.createElement('article');
      card.className = 'news-card';
      card.innerHTML = `
        <img src="${img}" alt="${escapeHtml(title)}" loading="lazy" decoding="async">
        <div style="padding:16px;">
          <h3 style="margin:0 0 8px;color:var(--gold)">${escapeHtml(title)}</h3>
          <p style="margin:0 0 12px;color:#ddd">${escapeHtml(excerpt)}</p>
          <a href="hirek.html#${n.id || ''}" style="color:var(--gold);font-weight:700">Tovább olvasom →</a>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  // --- Térkép inicializálása (Leaflet) ---
  let mapInstance = null;
  function initMap(markers) {
    const mapEl = document.getElementById('map');
    const noteEl = document.getElementById('map-note');

    if (!markers || markers.length === 0) {
      // ha nincs egyetlen marker sem, elrejthetjük vagy tájékoztathatjuk a felhasználót
      mapEl.style.display = 'none';
      noteEl.innerHTML = 'Nincsenek koordináták a portfóliós tételekben. Adjon hozzá <code>lat</code> és <code>lng</code> mezőket a <code>portfolio.hu.json</code>-hoz a térképes megjelenítéshez.';
      return;
    }

    mapEl.style.display = 'block';
    noteEl.innerHTML = '';

    // inicializáljuk a térképet
    mapInstance = L.map('map', { zoomControl: true, attributionControl: true });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '© OpenStreetMap'
    }).addTo(mapInstance);

    // bounds-ot számolunk
    const bounds = [];
    markers.forEach(m => {
      if (!isFinite(m.lat) || !isFinite(m.lng)) return;
      bounds.push([m.lat, m.lng]);
      const popup = `<strong>${escapeHtml(m.title)}</strong><br>${m.city || ''}<div style="margin-top:6px;color:#444">${m.snippet||''}</div>`;
      L.marker([m.lat, m.lng]).addTo(mapInstance).bindPopup(popup);
    });

    if (bounds.length === 1) {
      mapInstance.setView(bounds[0], 12);
    } else {
      mapInstance.fitBounds(bounds, {padding:[40,40]});
    }
  }

  // --- Contact form: mailto előkészítés ---
  document.getElementById('contact-form').addEventListener('submit', function (e) {
    e.preventDefault();
    const name = document.getElementById('c-name').value.trim();
    const company = document.getElementById('c-company').value.trim();
    const email = document.getElementById('c-email').value.trim();
    const message = document.getElementById('c-message').value.trim();

    if (!name || !email || !message) {
      alert('Kérlek töltsd ki az összes kötelező mezőt.');
      return;
    }

    const subject = encodeURIComponent(`Érdeklődés — Rail-Ready`);
    const bodyLines = [
      `Név: ${name}`,
      `Cég: ${company}`,
      `Email: ${email}`,
      '',
      'Üzenet:',
      message
    ];
    const body = encodeURIComponent(bodyLines.join('\n'));
    const to = 'harai.tamas@harai.hu';
    // mailto megnyitása
    window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
  });

  // --- Segédfüggvények ---
  function escapeHtml(s) {
    if (!s) return '';
    return String(s).replace(/[&<>"']/g, function (m) {
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]);
    });
  }

  // Érdeklődés gomb: előkészít egy emailt az ingatlanról
  window.openInterest = function(title, id) {
    const to = 'harai.tamas@harai.hu';
    const subject = encodeURIComponent(`Érdeklődés – ${decodeURIComponent(title)}`);
    const body = encodeURIComponent(`Tisztelt Cím!\n\nÉrdeklődöm az alábbi ingatlan iránt:\n\n${decodeURIComponent(title)}\nAzonosító: ${decodeURIComponent(id)}\n\nKérem, vegyék fel velem a kapcsolatot.\n\nNév:\nCég:\nTelefon:\n\nÜdvözlettel,`);
    window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
  };

  // oldalletöltéskor betöltjük a tartalmakat
  (function init() {
    loadPortfolio();
    loadNews();
  })();

  </script>
</body>
</html>
